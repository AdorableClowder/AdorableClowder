/*! skillit 2015-07-01 */
angular.module("skillitFactories",[]).factory("Auth",["$http","$location","$window",function(a,b,c){var d={};return d.login=function(b){return a({method:"POST",url:"/login",data:b}).then(function(a){return a.data.token})},d.signup=function(b){return a({method:"POST",url:"/signup",data:b}).then(function(a){return a.data.token})},d}]).factory("Users",["$http","$location","$window",function(a,b,c){var d={};return d.getOtherUsers=function(){return a({method:"GET",url:"/explore",headers:{"x-access-token":c.localStorage.getItem("skillitToken")}}).then(function(a){return a.data})},d.getUser=function(){return a({method:"GET",url:"/profile",headers:{"x-access-token":c.localStorage.getItem("skillitToken")}}).then(function(a){return a.data})},d}]),angular.module("chartCtrl",[]).controller("chartController",["Users","$location","filterFilter",function(a,b,c){}]),angular.module("exploreCtrl",[]).controller("exploreController",["Users","$location","filterFilter",function(a,b,c){var d=this;d.getSkills=function(){a.getOtherUsers(d.user).then(function(a){d.userArray=a,d.filterSkills(d.userArray)})["catch"](function(a){console.log(a),b.path("/login")})},d.filterSkills=function(a){var b=_.map(a,function(a){return a.offer});b=_.flatten(b),d.userSkills=_.uniq(b),0===d.userSkills.length&&(d.err="Sorry, no users are currently looking for your skills.")},d.getSkillStats=function(){console.log("getSkillStats firred"),a.getOtherUsers(d.user).then(function(a){var b=[];_.each(a,function(a){b.push(_.flatten(a.offer))});var c={};_.each(_.flatten(b),function(a){c[a]=c[a]+1||1});var e=_.pairs(c),f=_.sortBy(e,function(a){return a[1]});d.tally=f,console.log("tally: ",d.tally),d.populateDatasets(d.tally)})["catch"](function(a){console.log(a)})},d.populateDatasets=function(a){console.log("populateDatasets fired"),d.dataSets.length=0,_.each(a,function(a){var b={};b.label=a[0],b.value=a[1],b.color=_.sample(d.colors),b.hightlight="black",d.dataSets.push(b)}),console.log("vm.dataSets: ",d.dataSets)},d.shouldShow=!0,d.toggleView=function(){d.shouldShow=!d.shouldShow},d.showUsers=function(a){d.toggleView(),d.usersWithSkill=c(d.userArray,{offer:a})},d.getSkills(),d.dataSets=[],d.pieOptions={percentageInnerCutout:50,animationSteps:100,animateRotate:!0,animationEasing:"easeInSine",animateScale:!0,segmentStrokeColor:"#fff"},d.colors=["blue","green","red","black","white","orange"]}]),angular.module("loginCtrl",[]).controller("loginController",["Auth","$location","$window",function(a,b,c){var d=this;d.user={},d.doLogin=function(){a.login(d.user).then(function(a){console.log("login success!!"),c.localStorage.setItem("skillitToken",a),b.path("/explore")})["catch"](function(a){console.log(a),d.err=a.data.split("<br>")[0]})}}]),angular.module("profileCtrl",[]).controller("profileController",["Users","$location","$window",function(a,b,c){var d=this;d.user={},d.getProfile=function(){a.getUser().then(function(a){d.user=a})["catch"](function(a){console.log(a),b.path("/login")})},d.getProfile()}]),angular.module("signupCtrl",[]).controller("signupController",["Auth","$location","$window",function(a,b,c){var d=this;d.user={},d.initialWants=[],d.initialOffers=[],d.sampleCategories={language:["Spanish","Chinese","Esperanto"],technology:["IoT","Hacking Facebook","Bitcoin"],sports:["Baseball","Curling","Cow-tipping"],knowledge:["Art History","Art Garfunkel History","History"],wild:["Juggling","Busking","Moping"],business:["Money Laundering","Accounting","Financial Advice"],craftAndDesign:["Woodworking","Clay Pottery","Graphic Design"]},d.chooseOffers=!1,d.toggleWant=function(a){var b=d.initialWants.indexOf(a);b>-1?d.initialWants.splice(b,1):d.initialWants.push(a)},d.toggleOffer=function(a){var b=d.initialOffers.indexOf(a);b>-1?d.initialOffers.splice(b,1):d.initialOffers.push(a)},d.doSignup=function(){d.user.offer=d.initialOffers,d.user.want=d.initialWants,0===d.user.offer.length||0===d.user.want.length||void 0===d.user.username||void 0===d.user.password||void 0===d.user.email?d.err="Please fill out required fields":a.signup(d.user).then(function(a){console.log("signup success"),c.localStorage.setItem("skillitToken",a),b.path("/explore")})["catch"](function(a){console.log(a),d.err=a.data.split("<br>")[0]})}}]),angular.module("skillitDirectives",[]);var skillitApp=angular.module("skillitApp",["ui.router","loginCtrl","signupCtrl","exploreCtrl","profileCtrl","chartCtrl","skillitFactories","skillitDirectives"]);skillitApp.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("/",{url:"/",templateUrl:"app/views/view-home.html"}).state("signup",{url:"/signup",templateUrl:"app/views/view-signup.html"}).state("choose",{url:"/choosesubjects",templateUrl:"app/views/view-choosecategories.html"}).state("login",{url:"/login",templateUrl:"app/views/view-login.html"}).state("explore",{url:"/explore",templateUrl:"app/views/view-explore.html"}).state("explore.chart",{url:"/chart",templateUrl:"app/views/view-chart.html"}).state("profile",{url:"/profile",templateUrl:"app/views/view-profile.html"}).state("logout",{url:"/logout",controller:["$window","$location",function(a,b){a.localStorage.removeItem("skillitToken"),b.path("/login")}]})}]),skillitApp.run(["$rootScope","$window","$location",function(a,b,c){a.shouldShow=!1,a.$on("$stateChangeStart",function(){b.localStorage.getItem("skillitToken")?a.shouldShow=!0:a.shouldShow=!1})}]);