/*! skillit 2015-07-01 */
angular.module("skillitFactories",[]).factory("Auth",["$http","$location","$window",function(a,b,c){var d={};return d.login=function(b){return a({method:"POST",url:"/login",data:b}).then(function(a){return a.data.token})},d.signup=function(b){return a({method:"POST",url:"/signup",data:b}).then(function(a){return a.data.token})},d}]).factory("Users",["$http","$location","$window",function(a,b,c){var d={};return d.getOtherUsers=function(){return a({method:"GET",url:"/explore",headers:{"x-access-token":c.localStorage.getItem("skillitToken")}}).then(function(a){return a.data})},d.getUser=function(){return a({method:"GET",url:"/profile",headers:{"x-access-token":c.localStorage.getItem("skillitToken")}}).then(function(a){return a.data})},d.saveChanges=function(b){return console.log("Factories",b),a({method:"POST",url:"/profile",data:b,headers:{"x-access-token":c.localStorage.getItem("skillitToken")}}).then(function(a){return a.data.token})},d}]),angular.module("exploreCtrl",[]).controller("exploreController",["Users","$location","filterFilter",function(a,b,c){var d=this;d.getSkills=function(){a.getOtherUsers(d.user).then(function(a){d.userArray=a,d.filterSkills(d.userArray)})["catch"](function(a){console.log(a),b.path("/login")})},d.filterSkills=function(a){var b=_.map(a,function(a){return a.offer});b=_.flatten(b),d.userSkills=_.uniq(b),0===d.userSkills.length&&(d.err="Sorry, no users are currently looking for your skills.")},d.shouldShow=!0,d.toggleView=function(){d.shouldShow=!d.shouldShow},d.showUsers=function(a){d.toggleView(),d.usersWithSkill=c(d.userArray,{offer:a})}}]),angular.module("loginCtrl",[]).controller("loginController",["Auth","$location","$window",function(a,b,c){var d=this;d.user={},d.doLogin=function(){a.login(d.user).then(function(a){console.log("login success!!"),c.localStorage.setItem("skillitToken",a),b.path("/explore")})["catch"](function(a){console.log(a),d.err=a.data.split("<br>")[0]})}}]),angular.module("profileCtrl",[]).controller("profileController",["Users","$location","$window",function(a,b,c){var d=this;d.user={},d.formData={},d.formData.user=user,d.getProfile=function(){a.getUser().then(function(a){d.user=a})["catch"](function(a){console.log(a),b.path("/login")})},d.getProfile(),d.editorEnabled=!1,d.editOffers=!1,d.editWants=!1,d.editProfile=function(){d.editorEnabled=!0,d.editOffers=!0,d.editWants=!0,d.editableOffers=d.user.offer,d.editableWants=d.user.want},d.save=function(){d.user.offer=d.editableOffers,console.log(d.editableOffers),d.user.want=d.editableWants,d.editorEnabled=!1,d.editOffers=!1,d.editWants=!1,d.submitChanges()},d.submitChanges=function(){console.log("ProfileCtrl",d.user),a.saveChanges(d.user)}}]),angular.module("signupCtrl",[]).controller("signupController",["Auth","$location","$window",function(a,b,c){var d=this;d.user={},d.doSignup=function(){console.log("dosignup called"),a.signup(d.user).then(function(a){console.log("signup success"),c.localStorage.setItem("skillitToken",a),b.path("/choosesubjects")})["catch"](function(a){console.log(a),d.err=a.data.split("<br>")[0]})}}]).controller("subjectsController",["Users","$location","$window",function(a,b,c){var d=this;d.user={},d.wants=[],d.offers=[],d.getUser=function(){a.getUser().then(function(a){d.user=a,d.wants=d.user.want,d.offers=d.user.offer,console.log(d.user)})["catch"](function(a){console.log(a),b.path("/login")})},d.getUser(),d.sampleCategories={language:["Spanish","Chinese","Esperanto"],technology:["IoT","Hacking Facebook","Bitcoin"],sports:["Baseball","Curling","Cow-tipping"],knowledge:["Art History","Art Garfunkel History","History"],wild:["Juggling","Busking","Moping"],business:["Money Laundering","Accounting","Financial Advice"],craftAndDesign:["Woodworking","Clay Pottery","Graphic Design"]},d.chooseOffers=!1,d.toggleWant=function(a){var b=d.wants.indexOf(a);b>-1?d.wants.splice(b,1):d.wants.push(a)},d.toggleOffer=function(a){var b=d.offers.indexOf(a);b>-1?d.offers.splice(b,1):d.offers.push(a)},d.changePreferences=function(){a.saveChanges(d.user).then(function(a){console.log(a)})["catch"](function(a){console.log(a),b.path("/login")})}}]),angular.module("skillitDirectives",[]);var skillitApp=angular.module("skillitApp",["ui.router","loginCtrl","signupCtrl","exploreCtrl","profileCtrl","skillitFactories","skillitDirectives"]);skillitApp.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("/",{url:"/",templateUrl:"app/views/view-home.html"}).state("signup",{url:"/signup",templateUrl:"app/views/view-signup.html"}).state("choose",{url:"/choosesubjects",templateUrl:"app/views/view-choosecategories.html"}).state("login",{url:"/login",templateUrl:"app/views/view-login.html"}).state("explore",{url:"/explore",templateUrl:"app/views/view-explore.html"}).state("profile",{url:"/profile",templateUrl:"app/views/view-profile.html"}).state("logout",{url:"/logout",controller:["$window","$location",function(a,b){a.localStorage.removeItem("skillitToken"),b.path("/login")}]})}]),skillitApp.run(["$rootScope","$window","$location",function(a,b,c){}]);