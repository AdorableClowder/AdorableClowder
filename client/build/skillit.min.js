/*! skillit 2015-07-02 */
angular.module("skillitFactories",[]).factory("Auth",["$http","$location","$window",function(a,b,c){var d={};return d.setAction=function(b){return a({method:"POST",url:"/setaction",data:{action:b}}).then(function(a){return a})},d.login=function(b){return a({method:"POST",url:"/login",data:b}).then(function(a){return a.data.token})},d.signup=function(b){return a({method:"POST",url:"/signup",data:b}).then(function(a){return a.data.token})},d.setToken=function(){return a({method:"GET",url:"/linkedinsuccess",data:d.action}).then(function(a){return a.data})},d}]).factory("Users",["$http","$location","$window",function(a,b,c){var d={};return d.getOtherUsers=function(){return a({method:"GET",url:"/explore",headers:{"x-access-token":c.localStorage.getItem("skillitToken")}}).then(function(a){return a.data})},d.getUsersBySkill=function(b,d){return a({method:"GET",url:"/people",headers:{"x-access-token":c.localStorage.getItem("skillitToken")},params:{skill:b.skill,type:d}}).then(function(a){return a.data})},d.getUser=function(){return a({method:"GET",url:"/profile",headers:{"x-access-token":c.localStorage.getItem("skillitToken")}}).then(function(a){return a.data})},d.saveChanges=function(b){return console.log("Factories",b),a({method:"POST",url:"/profile",data:b,headers:{"x-access-token":c.localStorage.getItem("skillitToken")}}).then(function(a){return a.data.token})},d}]),angular.module("chartCtrl",[]).controller("chartController",["Users","$location","filterFilter",function(a,b,c){}]),angular.module("exploreCtrl",[]).controller("exploreController",["Users","$location","filterFilter",function(a,b,c){var d=this;d.getSkills=function(){a.getOtherUsers(d.user).then(function(a){d.userArray=a,d.filterSkills(d.userArray)})["catch"](function(a){console.log(a),b.path("/login")})},d.filterSkills=function(a){var b=_.map(a,function(a){return a.offer});b=_.flatten(b),d.userSkills=_.uniq(b),0===d.userSkills.length&&(d.err="Sorry, no users are currently looking for your skills.")},d.getSkillStats=function(){console.log("getSkillStats firred"),a.getOtherUsers(d.user).then(function(a){var b=[];_.each(a,function(a){b.push(_.flatten(a.offer))});var c={};_.each(_.flatten(b),function(a){c[a]=c[a]+1||1});var e=_.pairs(c),f=_.sortBy(e,function(a){return a[1]});d.tally=f,console.log("tally: ",d.tally)})["catch"](function(a){console.log(a)})},d.shouldShow=!0,d.toggleView=function(){d.shouldShow=!d.shouldShow},d.showUsers=function(a){d.toggleView(),d.usersWithSkill=c(d.userArray,{offer:a})},d.getSkills()}]),angular.module("loginCtrl",[]).controller("loginController",["Auth","$location","$window",function(a,b,c){var d=this;d.user={},d.setAction=function(){a.setAction("login")},d.doLogin=function(){a.login(d.user).then(function(a){console.log("login success!!"),c.localStorage.setItem("skillitToken",a),console.log(a),b.path("/explore")})["catch"](function(a){console.log(a),d.err=a.data.split("<br>")[0]})}}]),angular.module("peopleCtrl",[]).controller("peopleController",["Users","$location",function(a,b){var c=this;c.showOffers=!1,c.user={},c.wants=[],c.offers=[],c.getUser=function(){a.getUser().then(function(a){c.user=a,c.wants=c.user.want,c.offers=c.user.offer,console.log(c.user)})["catch"](function(a){console.log(a),b.path("/login")})},c.getUser(),c.currentWant={},c.currentOffer={},c.isSelected=function(a){return a.skill===c.currentWant.skill||a.skill===c.currentOffer.skill},c.selectWant=function(d){c.currentWant=d,a.getUsersBySkill(d,"offer").then(function(a){c.matchedOffers=a})["catch"](function(a){console.log(a),b.path("/login")})},c.selectOffer=function(d){c.currentOffer=d,a.getUsersBySkill(d,"want").then(function(a){c.matchedWants=a})["catch"](function(a){console.log(a),b.path("/login")})},$("[name='switch-checkbox']").bootstrapSwitch()}]),angular.module("profileCtrl",[]).controller("profileController",["Users","$location","$window",function(a,b,c){var d=this;d.user={},d.getProfile=function(){a.getUser().then(function(a){console.log("user sent back from profile request-------",a),d.user=a})["catch"](function(a){console.log(a),b.path("/login")})},d.getProfile(),d.changesSaved=!0,d.submitChanges=function(){d.changesSaved=!1,console.log("ProfileCtrl",d.user),a.saveChanges(d.user)}}]),angular.module("signupCtrl",[]).controller("signupController",["Auth","$location","$window",function(a,b,c){var d=this;d.user={},d.setAction=function(){a.setAction("signup").then(function(){console.log("action set")})["catch"](function(a){console.log(a)})},d.setToken=function(){a.setToken().then(function(a){console.log("user----------------------",a),c.localStorage.setItem("skillitToken",a),console.log("attempted choosesubjects"),b.path("/choosesubjects")})},d.doSignup=function(){console.log("dosignup called"),a.signup(d.user).then(function(a){console.log("signup success"),c.localStorage.setItem("skillitToken",a),b.path("/choosesubjects")})["catch"](function(a){console.log(a),d.err=a.data.split("<br>")[0]})}}]),angular.module("skillsCtrl",[]).controller("skillsController",["Users","$location","$window",function(a,b,c){var d=this;if(d.user={},d.getUser=function(){a.getUser().then(function(a){d.user=a})["catch"](function(a){console.log(a),b.path("/login")})},d.getUser(),d.wantCategories=[],null!==d.user.want)for(var e=0;e<d.user.want.length;e++)d.wantCategories.push(d.user.want[e].category);if(d.offerCategories=[],null!==d.user.offer)for(var f=0;f<d.user.offer.length;f++)d.offerCategories.push(d.user.offer[f].category);d.sampleCategories=["language","technology","sports","knowledge","wild","business","craftanddesign"],d.selectedCategory="category",d.selectCategory=function(a){d.selectedCategory=a},d.toggleWant=function(a){var b=d.user.want.indexOf(a);b>-1?d.user.want.splice(b,1):d.user.want.push(a)},d.toggleOffer=function(a){console.log("toggleOffer called");var b=d.user.offer.indexOf(a);b>-1?d.user.offer.splice(b,1):d.user.offer.push(a)}}]),angular.module("subjectCtrl",[]).controller("subjectsController",["Users","$location","$window",function(a,b,c){var d=this;d.user={},d.wants=[],d.offers=[],d.wantsSkills=[],d.offersSkills=[],d.wantsObj={},d.offersObj={},d.getUser=function(){a.getUser().then(function(a){d.user=a,d.wants=d.user.want,d.wantsSkills=d.wants.map(function(a){return a.skill}),d.offers=d.user.offer,d.offersSkills=d.offers.map(function(a){return a.skill}),console.log(d.user)})["catch"](function(a){console.log(a),b.path("/login")})},d.getUser(),d.categories=["Language Learning","Technology","Sports","Knowledge","Wild n Wacky","Business","Craft and Design"],d.sampleCategories={"Language Learning":["Spanish","Chinese","Esperanto"],Technology:["IoT","Hacking Facebook","Bitcoin"],Sports:["Baseball","Curling","Cow-tipping"],Knowledge:["Art History","Art Garfunkel History","History"],"Wild n Wacky":["Juggling","Busking","Moping"],Business:["Money Laundering","Accounting","Financial Advice"],"Craft and Design":["Woodworking","Clay Pottery","Graphic Design"]},d.selectedWantCategory="category",d.selectWantCategory=function(a){d.selectedWantCategory=a},d.selectedOfferCategory="category",d.selectOfferCategory=function(a){d.selectedOfferCategory=a},d.chooseOffers=!1,d.toggleWant=function(a,b){console.log("want",a),console.log("category",b);var c=d.wants.indexOf(a),e=d.wantsObj.category.indexOf(a);c>-1||e>-1?(d.wants.splice(c,1),d.wantsObj.category.splice(e,1)):(d.wants.push({skill:a,category:b}),d.WantsObj.category.push({skill:a,category:b}))},d.toggleOffer=function(a,b){var c=d.offers.indexOf(a),e=d.offersObj.category.indexOf(a);c>-1||e>-1?(d.offers.splice(c,1),d.offersObj.category.splice(e,1)):(d.offers.push({skill:a,category:b}),d.offersObj.category.push({skill:a,category:b}))},d.changesSaved=!0,d.changePreferences=function(){d.changesSaved=!1,a.saveChanges(d.user).then(function(a){console.log(a)})["catch"](function(a){console.log(a),b.path("/login")})};for(var e=0;e<d.categories.length;e++)d.wantsObj[d.categories[e]]=[],d.offersObj[d.categories[j]]=[]}]),angular.module("skillitDirectives",[]);var skillitApp=angular.module("skillitApp",["ui.router","loginCtrl","signupCtrl","exploreCtrl","profileCtrl","skillitFactories","skillitDirectives","subjectCtrl","peopleCtrl"]);skillitApp.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("/",{url:"/",templateUrl:"app/views/view-home.html",data:{requirelogin:!1}}).state("signup",{url:"/signup",templateUrl:"app/views/view-signup.html",data:{requirelogin:!1}}).state("choose",{url:"/choosesubjects",templateUrl:"app/views/view-updateSkills.html",data:{requirelogin:!0}}).state("login",{url:"/login",templateUrl:"app/views/view-login.html",data:{requirelogin:!1}}).state("linkedin",{url:"/linkedinsuccess",templateUrl:"app/views/view-linkedinsuccess.html",data:{requirelogin:!1}}).state("explore",{url:"/explore",templateUrl:"app/views/view-explore.html",data:{requirelogin:!0}}).state("explore.chart",{url:"/chart",templateUrl:"app/views/view-chart.html"}).state("people",{url:"/people",templateUrl:"app/views/view-people.html"}).state("profile",{url:"/profile",templateUrl:"app/views/view-profile.html",data:{requirelogin:!0}}).state("logout",{url:"/logout",controller:["$window","$location",function(a,b){a.localStorage.removeItem("skillitToken"),b.path("/login")}],data:{requirelogin:!0}})}]),skillitApp.run(["$rootScope","$window","$location","$state",function(a,b,c,d){a.shouldShow=!1,a.$on("$stateChangeStart",function(c,e){var f=b.localStorage.getItem("skillitToken"),g=e.data.requirelogin;f?a.shouldShow=!0:a.shouldShow=!1,!f&&g&&(c.preventDefault(),console.log("User Must be logged in to see this page"),d.go("login"))})}]);